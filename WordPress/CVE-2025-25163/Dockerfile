FROM wordpress:latest

# 安装 curl 和 unzip 用于下载和解压插件
RUN apt-get update && apt-get install -y curl unzip && rm -rf /var/lib/apt/lists/*

# 下载 Plugin A/B Image Optimizer (版本 3.3) 到 /usr/src/plugin 目录，并解压
RUN mkdir -p /usr/src/plugin && \
    cd /usr/src/plugin && \
    curl -L -o ab-image-optimizer.zip https://downloads.wordpress.org/plugin/ab-image-optimizer.3.3.zip && \
    unzip ab-image-optimizer.zip && \
    rm ab-image-optimizer.zip

# 复制自定义 entrypoint 脚本到镜像中
COPY docker-entrypoint.sh /usr/local/bin/docker-entrypoint.sh
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

# 使用自定义 entrypoint 启动容器
ENTRYPOINT ["docker-entrypoint.sh"]

CMD ["apache2-foreground"]
