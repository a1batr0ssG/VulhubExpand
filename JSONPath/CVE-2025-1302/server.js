const express = require('express');
const bodyParser = require('body-parser');
const {JSONPath} = require('jsonpath-plus');
const path = require("path");

const app = express();
const port = 3000;

// Guestbook list
var message = {
    "孔子": "三军可夺帅也，匹夫不可夺志也。",
    "老子": "千里之行，始于足下。",
    "庄子": "大鹏一日同风起，扶摇直上九万里。",
    "孟子": "天将降大任于斯人也，必先苦其心志。",
    "李白": "天生我材必有用，千金散尽还复来。",
    "苏轼": "谁道人生无再少？门前流水尚能西。",
    "曾国藩": "有志者，事竟成，破釜沉舟，百二秦关终属楚。",
    "鲁迅": "不在沉默中爆发，就在沉默中灭亡。",
    "王阳明": "破山中贼易，破心中贼难。",
    "胡适": "怕什么真理无穷，进一寸有一寸的欢喜。"
};
 
// Middleware to parse JSON bodies
app.use(bodyParser.json());

app.use(express.static(path.join(__dirname, 'public')));

app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, "public", "index.html"));
});

app.get('/data', (req, res) => {
    res.send(message);
});

// POST endpoint to accept message and jsonpath
app.post('/query', (req, res) => {
    const { path } = req.body;
    if (!message || !path) {
        return res.status(400).json({ error: 'Both message and path are required.' });
    }
    try {
        const result = JSONPath({path, json:message});
        res.json({ result });
    } catch (error) {
        res.status(400).json({ error: 'Invalid JSONPath or message.', details: error.message });
    }
});

app.listen(port, () => {
    console.log(`Server is running on http://localhost:${port}`);
});